<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coordina Events Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container mt-5">
      <h1 class="text-center mb-4">Coordina Events</h1>

      <!-- Top entry cards -->
      <div class="row text-center mb-4">
        <!-- Create Event -->
        <div class="col-md-4 mb-3">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
              <h4 class="card-title text-primary">Create Event</h4>
              <p class="text-muted">Plan and schedule a new event.</p>
              <a href="create.html" class="btn btn-primary mt-auto">Create</a>
            </div>
          </div>
        </div>

        <!-- Upcoming Events -->
        <div class="col-md-4 mb-3">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
              <h4 class="card-title text-success">Upcoming Events</h4>
              <p class="text-muted">View and manage upcoming events.</p>
              <a href="upcoming.html" class="btn btn-success mt-auto">View All</a>
            </div>
          </div>
        </div>

        <!-- Past Events -->
        <div class="col-md-4 mb-3">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
              <h4 class="card-title text-secondary">Past Events</h4>
              <p class="text-muted">See completed or archived events.</p>
              <a href="past.html" class="btn btn-secondary mt-auto">Browse All</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Event previews -->
      <div class="row">
        <!-- Upcoming Preview -->
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-white">
              <h5 class="m-0 text-success">Upcoming Events (Preview)</h5>
            </div>
            <div class="card-body" id="upcoming-list">
              <div class="text-muted text-center">Loading...</div>
            </div>
          </div>
        </div>

        <!-- Past Preview -->
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-header bg-white">
              <h5 class="m-0 text-secondary">Past Events (Preview)</h5>
            </div>
            <div class="card-body" id="past-list">
              <div class="text-muted text-center">Loading...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="text-center mt-5 text-muted">
      Â© 2025 Coordina Team
    </footer>

    <script>
      const API_URL = "http://localhost:5500/api/events";

      // Split events by status
      function classifyEvents(events) {
        const upcoming = [];
        const past = [];
        for (const e of events) {
          if (e.status === "scheduled" || e.status === "ongoing") {
            upcoming.push(e);
          } else if (e.status === "past") {
            past.push(e);
          }
        }
        return { upcoming, past };
      }

      // Render a list of events into a container
      function renderList(containerId, events, color) {
        const container = document.getElementById(containerId);
        if (!events.length) {
          container.innerHTML = `<div class="text-muted text-center">No events found.</div>`;
          return;
        }

        container.innerHTML = events
          .map(
            (ev) => `
              <div class="mb-3 border-bottom pb-2">
                <h6 class="text-${color}">${ev.name}</h6>
                <p class="small mb-1">
                  <strong>Status:</strong> ${ev.status}<br/>
                  ${
                    ev.eventLink
                      ? `<strong>Link:</strong> <a href="${ev.eventLink}" target="_blank">${ev.eventLink}</a>`
                      : ""
                  }
                </p>
              </div>`
          )
          .join("");
      }

      // Fetch events from the backend API
      fetch(API_URL)
        .then((res) => res.json())
        .then((data) => {
          const { upcoming, past } = classifyEvents(data);
          renderList("upcoming-list", upcoming.slice(0, 5), "success");
          renderList("past-list", past.slice(0, 5), "secondary");
        })
        .catch((err) => {
          console.error(err);
          document.getElementById("upcoming-list").innerHTML =
            "<div class='text-danger text-center'>Failed to load events.</div>";
          document.getElementById("past-list").innerHTML =
            "<div class='text-danger text-center'>Failed to load events.</div>";
        });
    </script>
  </body>
</html>
